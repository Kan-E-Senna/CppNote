# 7.限制对象只能在栈上创建或者只能在堆上创建

## 只能在堆上创建

如果需要对象只能在堆上创建，就是要求对象的构造和释放都只能由程序员来决定，这个时候所采用的方法，就可以是把析构函数置为私有，这样编译器就会因为无法访问析构函数而不会在栈上给对象分配空间。

```c++
class A {
public:
    A() {}
    void destory() { delete this;}
private:
    ~A(){}
};
```

但是只有这样做有一些缺点，第一是无法通过delete来释放对象空间，因为析构函数被置为私有，必须另外写一个destory函数在帮助销毁对象。第二是如果没法派生一个类，因为子类没法访问析构函数。因此，改进的策略就应该是把析构函数设置为protected。

```c++
class A {
public:
    A() {}
    void destory() { delete this;}
protected:
    ~A(){}
};
```

当然，也可以把构造函数和析构函数都置为protected，然后使用一个专门的create函数进行构建。

```c++
class A {
protected:
    A() {}
    ~A() {}
public:
    static A *create() {return new A();}
    void destory() {delete this;}
};
```

## 只能在栈上创建

那就禁用new就可以了，把new置为private即可，并且把delete也要置为private。

```c++
class A {
private:
    void *operator new(size_t t) {}  
    void operator delete(void *ptr) {}
public:
    A() {}
    ~A() {}
};
```

